<!DOCTYPE html>
<html lang="ro">

<head>
    <title>Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Negru Georgiana-Raluca">
    <meta name="description"
        content="Clinica si ambulanta veterinara non-stop, farmacie si servicii veterinare asigurate de clinica Helpet">
    <link rel="stylesheet" href="../css/login.css">
    <link rel="icon" type="image/x-icon" href="../resources/logo.jpg">

</head>

<body>
    <canvas id="canvas"></canvas>
    <div>
        <h2>
            Log in
        </h2>
        <br><br><br><br>
    </div>
    <form id="formular">
        <label for="username">Nume utilizator</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Parola</label>
        <input type="password" id="password" name="password">
        <button type="submit">Log In</button>

        </form>
        <script>

            function initializeUsers() {
                var promiseFetch = fetch('../JSON/login.json');
                promiseFetch.then(function (response) {
                    if (response.status == '200') {
                        return response.json();
                    }
                    else {
                        throw "Error fetching login.json"
                    }
                })
                    .then(function (users) {
                        if (!localStorage.getItem("users")) {
                            localStorage.setItem('users', JSON.stringify(users));
                        }
                    })
                    .catch(function (err) {
                        alert(err);
                    });
            }

            function checkLogin(username, password) {

                var users = JSON.parse(localStorage.getItem('users'));
                if (users) {
                    for (var i = 0; i < users.length; i++) {
                        if (users[i].username == username && users[i].password == password) {
                            return true;
                        }
                    }
                }
                return false;
            }
            document.getElementById('formular').onsubmit = function (event) {
                event.preventDefault();

                var username = document.getElementById('username').value;
                var password = document.getElementById('password').value;
                const usernamePattern = /^[a-zA-Z0-9]+$/;
                const passwordPattern = /^[A-Z][a-zA-Z0-9]{7,}$/;

                if (!usernamePattern.test(username)) {
                    const phrase1 = "Username-ul poate conține doar litere și cifre."
                    const upperCasePhrase1 = phrase1.toUpperCase();
                    alert(upperCasePhrase1);
                    event.stopPropagation();
                    event.preventDefault();
                    return;
                }

                if (!passwordPattern.test(password)) {
                    const phrase2 = "PAROLA TREBUIE SA INCEAPA CU O LITERA MARE, SA AIBA CEL PUTIN 8 CARACTERE SI SA CONTINA CEL PUTIN O CIFRA."
                    const upperCasePhrase2 = phrase2.toLowerCase();
                    alert(upperCasePhrase2);
                    event.stopPropagation();
                    event.preventDefault();
                    return;
                }
                var user = checkLogin(username, password)
                if (user) {
                    alert('Login successful!');
                    window.location.href = 'acasa.html';
                }
                else {
                    alert('Invalid username or password!');
                }
            };
            window.onload = function () {
                // Obținem contextul canvas-ului
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");

            // Setăm culoarea verde
            ctx.fillStyle = "#4CAF50"; // Verdele caracteristic

            // Dimensiunile barelor semnului plus
            const rectWidth = 20;
            const rectHeight = 80;

            // Calculăm pozițiile pentru a centra crucea pe canvas
            const canvasCenterX = canvas.width / 2;
            const canvasCenterY = canvas.height / 2;

            // Desenăm linia orizontală (bara orizontală a semnului plus)
            ctx.fillRect(canvasCenterX - rectWidth / 2, canvasCenterY - rectHeight / 2, rectWidth, rectHeight);

            // Desenăm linia verticală (bara verticală a semnului plus)
            ctx.fillRect(canvasCenterX - rectHeight / 2, canvasCenterY - rectWidth / 2, rectHeight, rectWidth);
                initializeUsers();
            };
        </script>
</body>